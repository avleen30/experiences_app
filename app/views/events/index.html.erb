<p id="notice"><%= notice %></p>


<div style="height: 500px" id='event-map'></div>


<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Cover img</th>
      <th>Start date</th>
      <th>End date</th>
      <th>Creator</th>
      <th>Longitude</th>
      <th>Latitude</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @events.each do |event| %>
      <tr>
        <td><%= event.name %></td>
        <td><%= event.description %></td>
        <td><%= image_tag event.cover_img %></td>
        <td><%= event.start_date %></td>
        <td><%= event.end_date %></td>
        <td><%= event.creator_id %></td>
        <td><%= event.lng %></td>
        <td><%= event.lat %></td>
        <td><%= link_to 'Show', event %></td>
        <td><%= link_to 'Edit', edit_event_path(event) %></td>
        <td><%= link_to 'Destroy', event, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>


<br>

<script>
      window.events = <%== @events.to_json %>;
function contentData (event){
  console.log('COVER IMAGE', event.cover_img)
return '<div id="content">'+
          '<div id="siteNotice">'+
          '</div>'+
          '<img src="' + event.cover_img + '" />' +
            '<h3 id="firstHeading" class="firstHeading">' + event.name + '</h3>'+

          '<div id="bodyContent">'+ event.description +'</div>'+
        '</div>';
}
function initMap() {
        var Toronto = {lat: 43.6532, lng: -79.3832};
        var map = new google.maps.Map(document.getElementById('event-map'), {
          zoom: 12,
          center: Toronto
        });



        fetch('/events.json')
          .then( function(resp) { return resp.json(); })
          .then( function(json) {
            json.forEach( function(event) {

               var infowindow = new google.maps.InfoWindow({
                content: contentData(event)
              });
              var marker = new google.maps.Marker({
                position: {lat: event.lat, lng: event.lng},
                map: map
              })
              marker.addListener('click', function() {
              infowindow.open(map, marker);
              });
            })
          });
        }

    </script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= Rails.application.secrets.google_key %>&callback=initMap">
</script>


<%= link_to 'New Event', new_event_path %>
